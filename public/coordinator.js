function urlencode(e){var t=[];for(var r in e)t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")}function ajax(e){function t(t,r){r||(r=null),t.error?"function"==typeof e.error&&e.error(t.error,t,r):"function"==typeof e.success&&e.success(t.result,t,r),"function"==typeof e.complete&&e.complete(t,r)}if(e.method=e.method||"GET",e.url){var r=e.url;e.query&&(r="object"==typeof e.query?r+"?"+urlencode(e.query):r+"?"+e.query),e.type=e.type||"json";var o=new XMLHttpRequest;if(o.open(e.method,r,!0),o.onreadystatechange=function(){if(4==o.readyState){var e={status:500,error:"The server is currently unavailable.",result:null};try{e=JSON.parse(o.responseText)}catch(r){}t(e,o)}},"json"===e.type&&"setRequestHeader"in o&&o.setRequestHeader("Accept","application/json"),e.body){var n=e.body;"object"==typeof n&&("overrideMimeType"in o&&o.overrideMimeType("application/x-www-form-urlencoded"),"setRequestHeader"in o&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n=urlencode(n)),o.send(n)}else o.send()}}function workerMessage(e){var t=e.data;switch(t.type){case"rate":this.rateHistory.unshift(t.rate),this.rateHistory.length>5&&this.rateHistory.pop(),rate.innerHTML="<strong>"+Math.floor(workers.totalHashRate())+"</strong><span>Hashes / Second</span>";break;case"submit":delete t.type,ajax({method:"post",url:"/api/submit",body:t})}}function updateBalance(){ajax({url:"/api/balance",success:function(e){e=Math.floor(1e3*e)/1e3,document.getElementById("balance-amount").innerHTML=e}})}function notify(e,t){var r=document.createElement("div"),o="notice"+Math.random().toString().substr(2);r.id=o,r.className="notice"+(t?" "+t:""),r.innerHTML=e,document.getElementById("header").appendChild(r),setTimeout(function(){r.parentNode.removeChild(r)},5e3)}function withdraw(){return ajax({url:"/api/withdraw",success:function(e){notify(e,"success")},error:function(e){notify(e,"error")}}),!1}var workers=[],rate=document.getElementById("rate");if(workers.stats={},workers.autoWorker=function(){if(!(this.totalHashRate()<1)){this.stats[this.length]=this.totalHashRate();var e=!1;if(this.length>=4&&(e=!0),this.stats[this.length]<1.2*this.stats[this.length-1]&&(e=!0),!e)return this.addWorker();clearInterval(this.autoInterval),this.removeWorker();var t=Math.floor(this.stats[this.length]);ga("send","event","hashrate","js",this.length,t)}},workers.totalHashRate=function(){var e,t,r,o,n,s=0;for(r=this.length,e=0;r>e;e+=1)if(o=this[e].rateHistory.length,o>0){for(n=0,t=0;o>t;t+=1)n+=this[e].rateHistory[t];s+=n/o}return s},workers.addWorker=function(){var e=new Worker("/public/worker.js");e.rateHistory=[],e.addEventListener("message",workerMessage,!1),workers.push(e),workers.getwork()},workers.removeWorker=function(){workers.pop().terminate()},workers.sendwork=function(e){for(var t=Math.floor(4294967295/this.length),r=0,o=0;o<this.length;o+=1)this[o].postMessage({type:"work",data:e,nonce:[r,r+=t]})},workers.pollwork=function(){ajax({url:"/api/work",query:{poll:"true"},success:function(e){return e?(this.sendwork(e),setTimeout(this.pollwork.bind(this),1e4),void 0):setTimeout(this.pollwork.bind(this),250)}.bind(this),error:function(){setTimeout(this.pollwork.bind(this),15e3)}.bind(this)})},workers.getwork=function(){ajax({url:"/api/work",success:function(e){this.sendwork(e),this.pollwork()}.bind(this),error:function(){setTimeout(this.getwork.bind(this),15e3)}.bind(this)})},"undefined"==typeof Worker)notify("Mining is not supported in this browser. Please update to the latest version."),ga("send","event","nosupport","noworker",{nonInteraction:1});else if("undefined"==typeof Uint8Array)notify("Mining is not supported in this browser. Please update to the latest version."),ga("send","event","nosupport","notypedarrays",{nonInteraction:1});else if(/(iphone|ipad|android|ios)/i.test(window.navigator.userAgent))notify("Mining is not supported on mobile devices. Please use a desktop or laptop computer.");else{var et=new ArrayBuffer(4),etu8=new Uint8Array(et),etu32=new Uint32Array(et);etu8[0]=1,1==etu32[0]?(workers.addWorker(),workers.autoInterval=setInterval(workers.autoWorker.bind(workers),3e4)):(notify("Mining is not yet supported on this computer. Sorry!"),ga("send","event","nosupport","bigendian",{nonInteraction:1}))}updateBalance(),setInterval(updateBalance,6e4),document.getElementById("email-form").addEventListener("submit",function(e){"preventDefault"in e&&e.preventDefault();var t=document.getElementById("email").value;return ajax({method:"post",url:"/api/email",body:{email:t},success:function(){notify("Your email has been saved.","success"),updateBalance()},error:function(e){notify(e,"error")}}),!1},!1),setTimeout(function(){window.location.reload()},72e5);